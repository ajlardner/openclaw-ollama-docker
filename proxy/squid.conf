# =============================================================================
# Squid Forward Proxy â€” Discord-Only Allowlist
# =============================================================================
# Only allows traffic to Discord API endpoints. Everything else is denied.

# Listening port
http_port 3128

# -----------------------------------------------------------------------------
# ACL Definitions
# -----------------------------------------------------------------------------

# Discord domains (all required for bot operation)
acl discord_domains dstdomain .discord.com
acl discord_domains dstdomain .discordapp.com
acl discord_domains dstdomain .discord.gg
acl discord_domains dstdomain .discord.media
acl discord_domains dstdomain .discordapp.net
acl discord_domains dstdomain gateway.discord.gg
acl discord_domains dstdomain cdn.discordapp.com
acl discord_domains dstdomain discord.com
acl discord_domains dstdomain discordapp.com

# SSL ports (HTTPS)
acl SSL_ports port 443
acl Safe_ports port 443

# CONNECT method for HTTPS tunneling
acl CONNECT method CONNECT

# -----------------------------------------------------------------------------
# Access Rules
# -----------------------------------------------------------------------------

# Deny non-safe ports
http_access deny !Safe_ports

# Deny CONNECT to non-SSL ports
http_access deny CONNECT !SSL_ports

# Allow Discord domains only
http_access allow discord_domains

# Deny everything else
http_access deny all

# -----------------------------------------------------------------------------
# Logging (minimal for container use)
# -----------------------------------------------------------------------------
access_log stdio:/dev/stdout
cache_log stdio:/dev/stderr

# No caching needed
cache deny all

# Security: hide version
httpd_suppress_version_string on

# DNS: use Docker's internal DNS
dns_nameservers 127.0.0.11
